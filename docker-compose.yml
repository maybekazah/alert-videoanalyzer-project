services:
  django:
    build: 
      context: ./django
      dockerfile: Dockerfile
    image: django_alert_project:1.0
    container_name: django_alert_project
    volumes:
      - ./output_data/:/app/output_data
      - ./backend/static:/app/static
      - ./logs:/app/logs
      - ./ssl:/app/ssl
    restart: always
    command: >
      sh -c "gunicorn --certfile=/app/ssl/cert.pem --keyfile=/app/ssl/privkey.pem --workers 8 --bind 0.0.0.0:8101 base.wsgi:application --timeout 120 & 
             daphne -b 0.0.0.0 -p 8102 base.asgi:application"
    env_file:
      - ./.env
    # depends_on:
    #   - postgres
    logging:
      driver: "local"
      options:
        max-size: "10m"
        max-file: "3"
    networks:
      - alert_project

  frontend_alerts:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    image: frontend_alert_project:1.0  
    container_name: frontend_alert_project
    volumes:
      - ./output_data/:/app/output_data
      - ./frontend:/app
      - ./logs:/app/logs
      - ./ssl:/etc/nginx/ssl
      - ./backend/static:/app/static
    restart: always
    depends_on:
      - django
    ports:
      # - "80:80"
      - "443:443"
    env_file:
      - ./.env
    logging:
      driver: "local"
      options:
        max-size: "10m"
        max-file: "3"
    networks:
      - alert_project


volumes:
  django:
  static:
  ssl:
  logs:
  pgadmin:
  postgres:
  weights:
  output_data:
  test_data:
  
networks:
  alert_project:
